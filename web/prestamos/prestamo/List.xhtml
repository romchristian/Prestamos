<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:gpymes="http://java.sun.com/jsf/composite/gpymes">
    <ui:composition template="/template.xhtml">

        <ui:define name="title">
            Listado de Prestamos
        </ui:define>
        <ui:define name="body">

            <h:form id="PrestamoListForm">

                <p:dataTable id="datalist" value="#{prestamoController.items}" var="p"
                             selectionMode="single" selection="#{prestamoController.selected}"
                             paginator="true"
                             paginatorPosition="bottom"
                             paginatorAlwaysVisible="false"
                             rowKey="#{p.id}"
                             rows="10"
                             rowsPerPageTemplate="10,20,30,40,50">

                    <p:ajax event="rowSelect"   update="createButton editButton imprimirButton confirmarButton cancelarButton imprimirLiqButton"/>
                    <p:ajax event="rowUnselect" update="createButton editButton imprimirButton confirmarButton cancelarButton imprimirLiqButton"/>

                    <f:facet name="header">
                        <p:commandButton id="createButton" icon="ui-icon-plus"   value="#{bundle.Create}" action="#{prestamoController.prepareCreate}" 
                                         rendered="#{(request.isUserInRole('admin') or request.isUserInRole('prestamos_edicion'))}"/>

                        <p:button id="editButton" value="#{bundle.Edit}"  outcome="Edit.xhtml"
                                  disabled="#{prestamoController.selected.estado == 'PENDIENTE_DESEMBOLSO' and prestamoController.haySeleccion() ? 'false':'true'}"
                                  rendered="#{(request.isUserInRole('admin') or request.isUserInRole('prestamos_edicion'))}">
                            <f:param name="id" value="#{prestamoController.selected.id == null ? 0:prestamoController.selected.id }"/>
                        </p:button>

                        <p:commandButton id="imprimirButton" action="#{prestamoController.imprimePagare()}" value="Imprimir Pagare" ajax="false"
                                         disabled="#{prestamoController.selected.estado == 'PENDIENTE_DESEMBOLSO' and prestamoController.haySeleccion()? 'false':'true'}"
                                         rendered="#{(request.isUserInRole('admin') or request.isUserInRole('prestamos_imprime_pagare'))}"/>


                        <p:commandButton id="confirmarButton" action="#{prestamoController.confirmaPagare()}" value="Confirmar Firma" update="datalist"
                                         disabled="#{prestamoController.selected.estado == 'PENDIENTE_DESEMBOLSO' and prestamoController.haySeleccion()? 'false':'true'}"
                                         rendered="#{(request.isUserInRole('admin') or request.isUserInRole('prestamos_confirma_pagare'))}"/>
                        
                        
                        <p:commandButton id="imprimirLiqButton" action="#{prestamoController.imprimeLiquidacionPrestamo()}" value="Imprimir Liq. Prestamo" ajax="false" update="datalist"
                                         disabled="#{prestamoController.selected.estado == 'PENDIENTE_DESEMBOLSO' and prestamoController.haySeleccion()? 'false':'true'}"
                                         rendered="#{(request.isUserInRole('admin') or request.isUserInRole('prestamos_imprime_pagare'))}"/>


                        <p:commandButton id="cancelarButton" action="#{prestamoController.anulaConfimacion()}" value="Cancelar Pagare" update="datalist"
                                         disabled="#{prestamoController.selected.estado == 'EN_DESEMBOLSO' and prestamoController.haySeleccion()? 'false':'true'}"
                                         rendered="#{(request.isUserInRole('admin') or request.isUserInRole('prestamos_cancela_pagare'))}"/>

                    </f:facet>

                    <p:column style="font-size: 12px">
                        <f:facet name="header">
                            Descripci√≥n
                        </f:facet>
                        <h:outputText value="Prestamo nro: #{p.id}"/>
                    </p:column>
                    <p:column style="font-size: 12px">
                        <f:facet name="header">
                            Fecha
                        </f:facet>
                        <h:outputText value="#{p.fecha}">
                            <f:convertDateTime pattern="#{formato.patronFecha}"/>
                        </h:outputText>
                    </p:column>                    
                    <p:column style="font-size: 12px">
                        <f:facet name="header">
                            Cliente
                        </f:facet>
                        <h:outputText value="#{p.cliente.devuelveNombreCompleto()}"/>
                    </p:column>
                    <p:column style="font-size: 12px">
                        <f:facet name="header">
                            Monto
                        </f:facet>
                        <h:outputText value="#{p.montoPrestamo}">
                            <f:convertNumber locale="#{formato.locale}" maxFractionDigits="0"/>
                        </h:outputText>
                    </p:column>
                    <p:column style="font-size: 12px">
                        <f:facet name="header">
                            Estado
                        </f:facet>
                        <h:outputText value="#{p.estado}"/>
                    </p:column>
                    <p:column style="font-size: 12px">
                        <f:facet name="header">
                            Pagare Firmado
                        </f:facet>
                        <h:outputText value="#{p.firmaPagare == true ? 'SI': 'NO'}"/>
                    </p:column>


                </p:dataTable>
            </h:form>


        </ui:define>

    </ui:composition>

</html>

