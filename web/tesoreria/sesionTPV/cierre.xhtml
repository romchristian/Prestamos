<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"

                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:gp="http://java.sun.com/jsf/composite/gpymes">

    <ui:decorate template="/plantillaABMTPV.xhtml">

        <ui:param name="titulo" value="Cierre Diario"/>


        <ui:define name="acciones">
            <p:outputPanel  styleClass="panelDatos" style="width: 100%;border: none!important;margin: 0!important;padding: 0!important;background: transparent!important;">


                <p:commandLink value="Confirmar" action="#{sesionTPVBean.cierraSesion()}" ajax="false"
                               styleClass="botonRojo flotaIzquierda" update="mensajes, panelControles"
                               />
                <p:commandButton value="Cancelar" action="terminalCaja"/>
            </p:outputPanel>

        </ui:define>

        <ui:define name="otrasAcciones">


            <p:splitButton value="Imprimir Reporte de Cierre" action="#{sesionTPVBean.imprimeReporteCajaCierre()}" icon="ui-icon-print" ajax="false">
                <!--                <p:menuitem value="Imprimir Reporte Detallado"/>-->
            </p:splitButton>
            <!--<p:commandButton value="Imprimir Reporte" action="{sesionTPVBean.cierraSesion()}"/>-->



        </ui:define>

        <ui:define name="cabecera">

            <style type="text/css">
                .titulo{
                    font-size: 12pt;
                    font-weight: bold;

                }

                .monto{
                    font-size: 12pt;
                    font-weight: bold;

                }
                .rojo{
                    font-size: 12pt;
                    font-weight: bold;
                    color: red;

                }

                .fila{
                    display: table-row;
                }
                .celda{
                    display: table-cell; width: 50%;
                    padding: 3px;    
                }
                .celda2{
                    display: table-cell; width: 100%;
                    font-size: 16pt;
                    font-weight: bold;
                    padding: 3px;    
                }
                .nodoTotal{
                    width: 100%;
                    font-size: 12pt;
                    font-weight: bold;
                    padding: 3px;    
                }

                .nodoSubTotal{
                    width: 100%;
                    font-size: 10pt;
                    padding: 3px;    
                }

                .derecha{
                    text-align: right;
                }

                .ui-tree .ui-tree-parent span,
                .ui-tree .ui-tree-item span {
                    float: left;
                    width: 100%!important;
                }

                .ui-tree{
                    width: 100%
                }


                .ui-blockui-content {
                    border: none!important;
                    background:none!important;
                }

                /*                .ui-shadow .ui-blockui-content {
                                      -moz-box-shadow: 0px 0px 0px rgba(0,0,0,0);
                                    -webkit-box-shadow: 0px 0px 0px rgba(0,0,0,0);
                                    box-shadow: 0px 0px 0px rgba(0,0,0,0.8);
                                }*/

                .ui-shadow{

                    -moz-box-shadow: 0px 0px 0px rgba(0,0,0,0);
                    -webkit-box-shadow: 0px 0px 0px rgba(0,0,0,0);
                    box-shadow: 0px 0px 0px rgba(0,0,0,0.8);
                }
            </style>    




            <p:blockUI id="blockUI" widgetVar="blockBody" block=":paginaEntera" trigger="@(.linkDetalles)">
                <p:graphicImage library="img" name="loading_bar.gif" width="256" style="background: transparent"/>
            </p:blockUI>

            <div style="display: table">
                <div style="display: table-cell;width: 30%" >
                    <p:fieldset legend="Inventario de Valores" style="margin-bottom:20px">
                        <p:outputPanel id="pnlvalores" styleClass="valores">
                            <p:dataTable value="#{sesionTPVBean.actual.valorEfectivos}" var="valor" id="valoresTable">
                                <p:column headerText="Valor">
                                    <h:outputText value="#{valor.denominacionMoneda}"/>
                                </p:column>
                                <p:column headerText="Cantidad" style="text-align: right">
                                    <p:inputText value="#{valor.cantidad}" size="5" style="text-align: right">
                                        <p:ajax event="blur" update="@(.saldos)" />  
                                    </p:inputText>
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:fieldset>

                </div>
                <div style="display: table-cell;width: 70%" >
                    <p:fieldset legend="Arqueo y Saldos" style="margin-bottom:20px" >

                        <p:panel id="saldoIncial" styleClass="saldos" style="border: none;">

                            <p:tree value="#{sesionTPVBean.root}" var="node" style="width: 100%;border: none;">
                                <p:treeNode styleClass="#{node.styleClass} treeResumen" id="treeResumen">
                                    <div style="display: table">
                                        <div class="celda">
                                            <p:commandLink value="#{node.descripcion}"
                                                           update=":dialogPagosForm"
                                                           oncomplete="PF('dialogPagos').show()"
                                                           action="#{sesionTPVBean.abreDetalleTransaccion(node)}"
                                                           styleClass="linkDetalles">
                                                

                                            </p:commandLink>
                                           

                                        </div>
                                        <div class="celda derecha" style="position: absolute; left: 49%">
                                            <h:outputText value="#{node.monto}">
                                                <f:convertNumber locale="#{formato.locale}"/>
                                            </h:outputText>

                                        </div>
                                    </div>

                                </p:treeNode>
                            </p:tree>
                            <div style="display: table; width: 100%">
                                <div style="display: table-row">
                                    <div class="celda">

                                    </div>
                                    <div class="celda derecha">

                                        <p:separator/>   

                                    </div>         

                                </div>
                                <div style="display: table-row">
                                    <div class="celda" style="padding-left: 25px">
                                        <h:outputText value="Saldo Teorico" styleClass="titulo"/>
                                    </div>
                                    <div class="celda derecha">
                                        <h:outputText value="#{sesionTPVBean.saldoTeorico}" styleClass="monto">
                                            <f:convertNumber currencySymbol="PYG"/> 
                                        </h:outputText>
                                    </div>                                
                                </div>


                                <div style="display: table-row">
                                    <div class="celda" style="padding-left: 25px">
                                        <h:outputText value="Saldo Cierre" styleClass="titulo"/>
                                    </div>
                                    <div class="celda derecha">
                                        <h:outputText value="#{sesionTPVBean.saldoCierre}" styleClass="monto">
                                            <f:convertNumber currencySymbol="PYG"/> 
                                        </h:outputText>
                                    </div>                                
                                </div>


                                <div style="display: table-row">
                                    <div class="celda" style="padding-left: 25px">
                                        <h:outputText value="Diferencia" styleClass="#{(sesionTPVBean.diferencia != 0 ? 'rojo':'titulo')}"/>
                                    </div>
                                    <div class="celda derecha">
                                        <h:outputText value="#{sesionTPVBean.diferencia}" styleClass="#{(sesionTPVBean.diferencia != 0 ? 'rojo':'moonto')}">
                                            <f:convertNumber currencySymbol="PYG"/> 
                                        </h:outputText>
                                    </div>                                
                                </div>
                            </div>

                        </p:panel>
                    </p:fieldset>


                </div>
            </div>






        </ui:define>

        <ui:define name="dialogos">

            <p:dialog id="dlgPagos" header="Transacciones" widgetVar="dialogPagos"  resizable="false" modal="true">

                <h:form id="dialogPagosForm" styleClass="dialogPagosForm">



                    <p:dataTable value="#{sesionTPVBean.detalleTrasacciones}" var="p">
                        <p:column headerText="Fecha">
                            <h:outputText value="#{p.transaccion.fecha}">
                                <f:convertDateTime locale="#{formato.locale}" pattern="#{formato.patronFechaHora}" timeZone="America/Asuncion"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Operación">
                            <h:outputText value="#{p.transaccion.tipoTransaccionCaja.descripcion}"/>
                        </p:column>
                        <p:column headerText="Forma Pago">
                            <h:outputText value="#{p.descripcion}"/>
                        </p:column>
                        <p:column headerText="Descripción">
                            <h:outputText value="#{p.transaccion.descripcion}"/>
                        </p:column>
                        <p:column headerText="Ingreso">
                            <h:outputText value="#{(p.transaccion.tipoTransaccion == 'ENTRADA' ? p.monto : 0)}">
                                <f:convertNumber locale="#{formato.locale}"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Egreso">
                            <h:outputText value="#{(p.transaccion.tipoTransaccion == 'SALIDA' ? p.monto : 0)}">
                                <f:convertNumber locale="#{formato.locale}"/>
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                    <p:commandButton value="Cerrar" onclick="PF('dialogPagos').hide()"/>

                </h:form>

            </p:dialog>

        </ui:define>
    </ui:decorate>

</ui:composition>
